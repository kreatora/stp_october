import"./input.DqLi17n7.js";/* empty css               */import{r as l,j as o,R as Te,a as Le}from"./client.C3rq0lfV.js";const N=220,ne=130,pe=300,Xe=180,me=900,Ae=()=>{const[m,se]=l.useState("tree"),[V,ve]=l.useState(""),[M,X]=l.useState(null),[D,A]=l.useState(new Set),[ye,oe]=l.useState(new Set),[Z,be]=l.useState(new Set),[xe,we]=l.useState(new Set),[u,q]=l.useState([]),[Ce,Ie]=l.useState([]),[E,G]=l.useState(.6),[R,F]=l.useState(0),[$,O]=l.useState(0),[Y,ie]=l.useState(!1),[U,je]=l.useState({x:0,y:0}),[Q,Se]=l.useState({x:0,y:0}),[ae,H]=l.useState(null),[w,B]=l.useState(null),g=l.useRef(null),y=l.useRef(null),le=l.useRef(0),re=l.useRef(0),_=l.useRef(null),ce=l.useCallback(()=>{y.current&&(y.current.style.transform=`translate3d(${R}px, ${$}px, 0) scale(${E})`)},[R,$,E]);l.useEffect(()=>{ce()},[ce]);const k=l.useMemo(()=>"./ontology_interactive.pdf",[]);l.useEffect(()=>{let e=!1;return(async()=>{try{const t=await fetch(k,{method:"HEAD"});e||X(t.ok)}catch{e||X(!1)}})(),()=>{e=!0}},[k]);const Ee=l.useCallback(async()=>{if(M===!1){window.alert("PDF not available yet. Drop the file in /public as ontology.pdf and it will enable automatically.");return}try{if(!(await fetch(k,{method:"HEAD"})).ok)throw new Error("PDF missing");X(!0);const t=document.createElement("a");t.href=k,t.download="ontology_interactive.pdf",document.body.appendChild(t),t.click(),t.remove()}catch{X(!1),window.alert("PDF not available yet. Drop the file in /public as ontology.pdf and it will enable automatically.")}},[M,k]),b=l.useCallback((e,t)=>{if(!e||e.length===0||!g.current)return;let n=1/0,s=1/0,c=-1/0,i=-1/0;e.forEach(v=>{n=Math.min(n,v.x),s=Math.min(s,v.y),c=Math.max(c,v.x+N),i=Math.max(i,v.y+ne)});const r=e.length>1?50:20;n-=r,s-=r,c+=r,i+=r;const a=g.current.offsetWidth,d=g.current.offsetHeight,f=c-n,h=i-s,p=n+f/2,S=s+h/2,C=t??Math.min(Math.min(a/f,d/h)*.95,1.5),I=y.current,j=++re.current;if(I){I.style.transition=`transform ${me}ms cubic-bezier(0.22, 1, 0.36, 1)`,_.current!=null&&(window.clearTimeout(_.current),_.current=null);const v=()=>{re.current===j&&y.current&&(y.current.style.transition="none")},ke=Pe=>{Pe.propertyName==="transform"&&v()};I.addEventListener("transitionend",ke,{once:!0}),_.current=window.setTimeout(()=>{v()},me+50)}G(C),F(a/2-p*C),O(d/2-S*C)},[G,F,O]),de=l.useCallback(e=>{const t=[];e.forEach(n=>{if(n.parentId&&n.visible){const s=e.find(c=>c.id===n.parentId);s&&s.visible&&t.push({id:`conn-${s.id}-${n.id}`,x1:s.x+N/2,y1:s.y+ne,x2:n.x+N/2,y2:n.y,level:Math.min(s.level,5)})}}),Ie(t)},[]),J=l.useCallback((e,t,n,s,c,i=!1)=>{const r=`node_${le.current++}`,a={...e,id:r,label:e.name,definition:e.definition||e.name,x:t,y:n,level:s,parentId:c,isRoot:i,visible:i,collapsed:!0,children:[]};let d=[a];if(e.children&&e.children.length>0){const f=e.children.length*pe;let h=t+N/2-f/2;e.children.forEach(p=>{var j;const S=h,C=n+Xe,I=J(p,S,C,s+1,r);(j=a.children)==null||j.push(...I.filter(v=>v.parentId===r)),d=d.concat(I),h+=pe})}return d},[]);l.useEffect(()=>{const e="./ontology_tree.json";console.log(`Fetching data from: ${e}`),fetch(e).then(t=>{if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);return t.json()}).then(t=>{console.log("Fetched ontology data:",t),le.current=0;const n=Array.isArray(t)?t[0]:t;if(!n){console.error("Ontology data is empty or invalid.");return}const i=J(n,50,50,0,null,!0);console.log("Processed nodes (full array):",i),console.log("Processed nodes length:",i.length),y.current&&(console.log("Visualization container width:",y.current.offsetWidth),console.log("Visualization container height:",y.current.offsetHeight)),i.slice(0,5).forEach(r=>{console.log(`Node ${r.id}: x=${r.x}, y=${r.y}, visible=${r.visible}, collapsed=${r.collapsed}`)}),q(i),i.length>0&&setTimeout(()=>{console.log("Initial centering on visible nodes");const r=i.filter(a=>a.visible);b(r)},100)}).catch(t=>console.error("Error loading ontology data:",t))},[J,b]),l.useEffect(()=>{de(u)},[u,de]);const K=l.useCallback((e,t)=>{const n=[],s=[e],c=new Map;for(t.forEach(i=>{i.parentId&&(c.has(i.parentId)||c.set(i.parentId,[]),c.get(i.parentId).push(i.id))});s.length>0;){const i=s.pop(),r=c.get(i)||[];for(const a of r)n.push(a),s.push(a)}return n},[]),Ne=l.useCallback(e=>{q(t=>{const n=t.find(a=>a.id===e);if(!n)return t;B(n);let s=[...t];if(!n.children||n.children.length===0){if(ae===e){H(null);const a=s.find(d=>d.id===n.parentId);if(a){const d=s.filter(f=>f.parentId===a.id&&f.visible);b([a,...d])}else b([n])}else if(H(e),g.current){const d=g.current.getBoundingClientRect().width*.1,f=Math.min(d/N,.9);b([n],f)}return s}H(null);const i=!n.collapsed;if(i||s.filter(d=>d.parentId===n.parentId&&d.id!==e&&!d.collapsed).forEach(d=>{const f=K(d.id,s);s=s.map(h=>h.id===d.id?{...h,collapsed:!0,visible:!0}:f.includes(h.id)?{...h,visible:!1,hiddenByCollapse:!0,collapsed:!0}:h)}),s=s.map(a=>a.id===e?{...a,collapsed:i}:a.parentId===e&&i?{...a,visible:!1,hiddenByCollapse:!0}:a.parentId===e&&!i?{...a,visible:!0,hiddenByCollapse:!1}:a),i){const a=K(e,s);s=s.map(d=>a.includes(d.id)?{...d,visible:!1,hiddenByCollapse:!0,collapsed:!0}:d)}else s=s.map(a=>a.parentId===e?{...a,visible:!0,hiddenByCollapse:!1}:a);const r=s.filter(a=>a.parentId===e&&a.visible);return b(i?[n]:[n,...r]),s})},[ae,b,K]),Me=e=>{e.target!==g.current&&e.target!==y.current&&!e.target.classList.contains("visualization-container")||(ie(!0),je({x:e.clientX,y:e.clientY}),Se({x:R,y:$}),g.current&&(g.current.style.cursor="grabbing"))},z=l.useCallback(e=>{if(!Y)return;const t=e.clientX-U.x,n=e.clientY-U.y;F(Q.x+t),O(Q.y+n)},[Y,U,Q]),W=l.useCallback(()=>{ie(!1),g.current&&(g.current.style.cursor="grab")},[]);l.useEffect(()=>(Y?(document.addEventListener("mousemove",z),document.addEventListener("mouseup",W)):(document.removeEventListener("mousemove",z),document.removeEventListener("mouseup",W)),()=>{document.removeEventListener("mousemove",z),document.removeEventListener("mouseup",W)}),[Y,z,W]);const ee=l.useCallback(e=>{if(!g.current)return;e.preventDefault();const t=g.current.getBoundingClientRect(),n=e.clientX-t.left,s=e.clientY-t.top,c=(n-R)/E,i=(s-$)/E,r=1.05;let a;e.deltaY<0?a=Math.min(E*r,1.5):a=Math.max(E/r,.3);const d=n-c*a,f=s-i*a;G(a),F(d),O(f)},[R,$,E]);l.useEffect(()=>{if(m!=="tree")return;const e=g.current;if(e)return e.addEventListener("wheel",ee,{passive:!1}),()=>{e.removeEventListener("wheel",ee)}},[ee,m]);const te=l.useCallback(()=>{H(null),B(null),q(e=>{const t=e.find(s=>s.isRoot);if(!t)return e;const n=e.map(s=>({...s,visible:!!s.isRoot,collapsed:!0,hiddenByCollapse:!1}));return setTimeout(()=>b([t]),0),n})},[b]),ue=l.useRef(m);l.useEffect(()=>{const e=ue.current;m==="tree"&&e!=="tree"&&te(),ue.current=m},[m,te]);const De=l.useMemo(()=>{if(m!=="tree")return new Set;const e=u.filter(c=>c.visible),t=new Set,n=N,s=ne;for(let c=0;c<e.length;c++){const i=e[c],r=i.x,a=i.y,d=i.x+n,f=i.y+s;for(let h=c+1;h<e.length;h++){const p=e[h],S=p.x,C=p.y,I=p.x+n,j=p.y+s;r<I&&d>S&&a<j&&f>C&&(t.add(i.id),t.add(p.id))}}return t},[u,m]),x=l.useMemo(()=>new Map(u.map(e=>[e.id,e])),[u]),P=l.useMemo(()=>{const e=new Map;for(const t of u){if(!t.parentId)continue;const n=t.parentId;e.has(n)||e.set(n,[]),e.get(n).push(t.id)}for(const[t,n]of e.entries())n.sort((s,c)=>{var i,r;return(((i=x.get(s))==null?void 0:i.name)??"").localeCompare(((r=x.get(c))==null?void 0:r.name)??"")}),e.set(t,n);return e},[u,x]);l.useEffect(()=>{u.length&&A(e=>{if(e.size>0)return e;const t=new Set;for(const n of u)n.isRoot&&t.add(n.id);return t})},[u]);const Re=l.useCallback(e=>{A(t=>{const n=new Set(t),s=n.has(e);if(s?n.delete(e):n.add(e),!s){const c=P.get(e)??[];c.length&&(oe(new Set(c)),window.setTimeout(()=>oe(new Set),180))}return n})},[P]),$e=l.useCallback(e=>{be(t=>{const n=new Set(t);return n.has(e)?n.delete(e):n.add(e),n})},[]),fe=l.useRef(new Map),he=l.useCallback(e=>{if(!e){A(new Set(u.filter(t=>t.isRoot).map(t=>t.id)));return}A(new Set(u.map(t=>t.id)))},[u]),T=l.useMemo(()=>{var s,c;const e=V.trim().toLowerCase();if(!e)return null;const t=new Set;for(const i of u){const r=((s=i.name)==null?void 0:s.toLowerCase())??"",a=((c=i.definition)==null?void 0:c.toLowerCase())??"";(r.includes(e)||a.includes(e))&&t.add(i.id)}const n=new Set;for(const i of t){let r=x.get(i);for(;r&&!n.has(r.id);)n.add(r.id),r=r.parentId?x.get(r.parentId):void 0}return n},[u,x,V]),L=l.useMemo(()=>{var s,c;if(!u.length)return[];const e=u.filter(i=>i.isRoot||!i.parentId).sort((i,r)=>i.name.localeCompare(r.name)),t=[],n=e.map(i=>({id:i.id,depth:0})).reverse();for(;n.length;){const{id:i,depth:r}=n.pop(),a=x.get(i);if(!a||T&&!T.has(i))continue;const d=a.parentId?((s=x.get(a.parentId))==null?void 0:s.name)??"—":"—",f=(((c=P.get(a.id))==null?void 0:c.length)??0)>0,h=[];let p=a;const S=new Set;for(;p&&!S.has(p.id);)S.add(p.id),h.push(p.name),p=p.parentId?x.get(p.parentId):void 0;const C=h.reverse().join(" › ");if(t.push({node:a,parentName:d,path:C,depth:r,hasChildren:f}),f&&(T?!0:D.has(a.id))){const j=P.get(a.id)??[];for(let v=j.length-1;v>=0;v--)n.push({id:j[v],depth:r+1})}}return t},[u,x,P,D,T]);return l.useEffect(()=>{if(m!=="tableInteractive")return;const e=window.requestAnimationFrame(()=>{const t=new Set;for(const n of L){const s=fe.current.get(n.node.id);s&&s.scrollHeight>s.clientHeight+1&&t.add(n.node.id)}we(t)});return()=>window.cancelAnimationFrame(e)},[L,m]),o.jsxs("div",{className:"viewport",ref:g,onMouseDown:Me,children:[o.jsxs("div",{className:"ontology-toolbar",role:"toolbar","aria-label":"Ontology controls",children:[o.jsxs("div",{className:"view-toggle",role:"tablist","aria-label":"Switch view",children:[o.jsx("button",{type:"button",role:"tab","aria-selected":m==="tree",className:`view-toggle-button ${m==="tree"?"active":""}`,onClick:()=>se("tree"),children:"Tree view"}),o.jsx("button",{type:"button",role:"tab","aria-selected":m==="tableInteractive",className:`view-toggle-button ${m==="tableInteractive"?"active":""}`,onClick:()=>se("tableInteractive"),children:"Table view"})]}),o.jsx("div",{className:"toolbar-right",children:o.jsxs("div",{className:"pdf-cta",children:[o.jsx("span",{className:"pdf-cta-text",children:"Download ontology as PDF"}),o.jsx("button",{type:"button",className:`pdf-button ${M===!1?"disabled":""}`,onClick:Ee,disabled:M===!1,title:M===!1?"PDF not uploaded yet":"Download ontology as PDF",children:"PDF"})]})})]}),m==="tree"?o.jsxs(o.Fragment,{children:[o.jsxs("div",{className:"visualization-container",ref:y,children:[u.filter(e=>e.visible).map(e=>o.jsxs("div",{className:`card ${e.isRoot?"root-card":""} ${e.collapsed?"collapsed":""} ${(w==null?void 0:w.id)===e.id?"selected":""} ${De.has(e.id)?"overlapping":""}`,style:{left:`${e.x}px`,top:`${e.y}px`},onClick:t=>{t.stopPropagation(),Ne(e.id)},"data-id":e.id,"data-level":e.level,"data-parent-id":e.parentId,children:[o.jsx("div",{className:"card-name",children:e.name}),e.children&&e.children.length>0&&o.jsx("div",{className:"expand-icon"})]},e.id)),Ce.map(e=>o.jsx("div",{className:`connection-line connection-line-level-${e.level}`,style:{width:`${Math.sqrt(Math.pow(e.x2-e.x1,2)+Math.pow(e.y2-e.y1,2))}px`,left:`${e.x1}px`,top:`${e.y1}px`,transform:`rotate(${Math.atan2(e.y2-e.y1,e.x2-e.x1)*180/Math.PI}deg)`}},e.id))]}),o.jsx("div",{className:"zoom-controls",children:o.jsx("button",{className:"reset-button",onClick:te,children:"Reset"})})]}):o.jsxs("div",{className:"ontology-table-wrap",role:"region","aria-label":"Ontology table",children:[o.jsxs("div",{className:"ontology-table-controls",children:[o.jsxs("div",{className:"ontology-search",children:[o.jsx("label",{className:"ontology-search-label",htmlFor:"ontology-search-input",children:"Search"}),o.jsx("input",{id:"ontology-search-input",className:"ontology-search-input",value:V,onChange:e=>ve(e.target.value),placeholder:"Search concepts, definitions…"})]}),o.jsxs("div",{className:"ontology-table-actions",children:[o.jsx("button",{type:"button",className:"ontology-mini-button",onClick:()=>he(!0),children:"Expand all"}),o.jsx("button",{type:"button",className:"ontology-mini-button",onClick:()=>he(!1),children:"Collapse all"})]}),o.jsxs("div",{className:"ontology-table-meta",children:[L.length.toLocaleString()," concepts"]})]}),o.jsx("div",{className:"ontology-table-card",children:o.jsxs("table",{className:"ontology-table ontology-table-interactive",children:[o.jsx("thead",{children:o.jsxs("tr",{children:[o.jsx("th",{children:"Concept"}),o.jsx("th",{children:"Parent"}),o.jsx("th",{children:"Definition"})]})}),o.jsxs("tbody",{children:[L.map(e=>o.jsxs("tr",{className:[(w==null?void 0:w.id)===e.node.id?"selected":"",ye.has(e.node.id)?"just-revealed":""].filter(Boolean).join(" "),onClick:()=>B(e.node),children:[o.jsx("td",{children:o.jsxs("div",{className:"ontology-interactive-cell",children:[e.depth>0?o.jsx("span",{className:"ontology-indent-guides",style:{width:`${e.depth*18}px`},"aria-hidden":"true"}):null,e.hasChildren?o.jsx("button",{type:"button",className:"ontology-disclosure","aria-label":D.has(e.node.id)?"Collapse":"Expand","aria-expanded":D.has(e.node.id),onClick:t=>{t.stopPropagation(),Re(e.node.id)},children:T||D.has(e.node.id)?"▾":"▸"}):o.jsx("span",{className:"ontology-disclosure-spacer","aria-hidden":"true"}),o.jsxs("div",{className:"ontology-table-concept",children:[o.jsx("div",{className:"ontology-table-name",children:e.node.name}),o.jsx("div",{className:"ontology-table-path",children:e.path})]})]})}),o.jsx("td",{className:"ontology-table-parent",children:e.parentName}),o.jsx("td",{children:o.jsxs("div",{className:"ontology-definition-cell",children:[o.jsx("div",{ref:t=>{const n=fe.current;t?n.set(e.node.id,t):n.delete(e.node.id)},className:`ontology-table-definition ${Z.has(e.node.id)?"expanded":""}`,children:e.node.definition}),Z.has(e.node.id)||xe.has(e.node.id)?o.jsx("button",{type:"button",className:"ontology-more-button",onClick:t=>{t.stopPropagation(),$e(e.node.id)},children:Z.has(e.node.id)?"Less":"More"}):null]})})]},e.node.id)),L.length===0&&o.jsx("tr",{children:o.jsx("td",{colSpan:3,className:"ontology-table-empty",children:"No results. Try a different search query."})})]})]})})]}),m==="tree"&&w&&o.jsxs("div",{className:"definition-panel",children:[o.jsx("h3",{className:"panel-title",children:w.name}),o.jsx("p",{className:"panel-definition",children:w.definition}),o.jsx("button",{className:"close-panel-button",onClick:()=>B(null),children:"X"})]})]})},ge=document.getElementById("ontology-container");ge?Te.createRoot(ge).render(o.jsx(Le.StrictMode,{children:o.jsx(Ae,{})})):console.error("Failed to find the ontology-container element.");
